<?xml version="1.0"?>
<sdf version="1.9">
    <model name='car' canonical_link='chassis::chassis_link'>
        <include>
            <uri>model://chassis</uri>
            <name>chassis</name>
            <pose>0 0 0.4 0 0 0</pose>
        </include>
        <pose>0 0 0 0 0 0</pose>

        <frame name="lidar_frame" attached_to='chassis::chassis_link'>
            <pose>1.05 0 0.5 0 0 0</pose>
        </frame>

        <include>
            <uri>model://tire</uri>
            <name>left_front_wheel</name>
            <pose>0.5 0.6 0.4 -1.5707 0 0</pose>
        </include>
        <include>
            <uri>model://tire</uri>
            <name>right_front_wheel</name>
            <pose>0.5 -0.6 0.4 -1.5707 0 0</pose>
        </include>
        <include>
            <uri>model://tire</uri>
            <name>left_rear_wheel</name>
            <pose>-0.5 0.6 0.4 -1.5707 0 0</pose>
        </include>
        <include>
            <uri>model://tire</uri>
            <name>right_rear_wheel</name>
            <pose>-0.5 -0.6 0.4 -1.5707 0 0</pose>
        </include>

        <include>
            <uri>model://knuckle</uri>
            <name>left_steering_knuckle</name>
            <pose>0.5 0.6 0.4 0 0 0</pose>
        </include>

        <joint name='left_steering_joint' type='revolute'>
            <parent>chassis::chassis_link</parent>
            <child>left_steering_knuckle::knuckle_link</child>
            <axis>
                <xyz>0 0 1</xyz>
                <limit>
                    <lower>-0.6</lower>
                    <upper>0.6</upper>
                    <effort>1000000</effort>
                </limit>
            </axis>
        </joint>

        <joint name='left_front_wheel_joint' type='revolute'>
            <pose relative_to='left_front_wheel' />
            <parent>left_steering_knuckle::knuckle_link</parent>
            <child>left_front_wheel::tire_link</child>
            <axis>
                <xyz expressed_in='__model__'>0 1 0</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
            </axis>
        </joint>

        <include>
            <uri>model://knuckle</uri>
            <name>right_steering_knuckle</name>
            <pose>0.5 -0.6 0.4 0 0 0</pose>
        </include>

        <joint name='right_steering_joint' type='revolute'>
            <parent>chassis::chassis_link</parent>
            <child>right_steering_knuckle::knuckle_link</child>
            <axis>
                <xyz>0 0 1</xyz>
                <limit>
                    <lower>-0.6</lower>
                    <upper>0.6</upper>
                    <effort>1000000</effort>
                </limit>
            </axis>
        </joint>

        <joint name='right_front_wheel_joint' type='revolute'>
            <pose relative_to='right_front_wheel' />
            <parent>right_steering_knuckle::knuckle_link</parent>
            <child>right_front_wheel::tire_link</child>
            <axis>
                <xyz expressed_in='__model__'>0 1 0</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
            </axis>
        </joint>

        <joint name='left_rear_wheel_joint' type='revolute'>
            <pose relative_to='left_rear_wheel' />
            <parent>chassis::chassis_link</parent>
            <child>left_rear_wheel::tire_link</child>
            <axis>
                <xyz expressed_in='__model__'>0 1 0</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
            </axis>
        </joint>

        <joint name='right_rear_wheel_joint' type='revolute'>
            <pose relative_to='right_rear_wheel' />
            <parent>chassis::chassis_link</parent>
            <child>right_rear_wheel::tire_link</child>
            <axis>
                <xyz expressed_in='__model__'>0 1 0</xyz>
                <limit>
                    <lower>-1.79769e+308</lower>
                    <upper>1.79769e+308</upper>
                </limit>
            </axis>
        </joint>
        <!--공식적으로 제공되는 플러그인을 찾아서 구현하였음-->
        <plugin
            filename="ignition-gazebo-ackermann-steering-system"
            name="ignition::gazebo::v6::systems::AckermannSteering">
            <topic>/cmd_vel</topic>
            <left_steering_joint>left_steering_joint</left_steering_joint>
            <right_steering_joint>right_steering_joint</right_steering_joint>
            <left_joint>left_rear_wheel_joint</left_joint>
            <right_joint>right_rear_wheel_joint</right_joint>
            <wheel_base>1.0</wheel_base>
            <wheel_separation>1.2</wheel_separation>
            <wheel_radius>0.4</wheel_radius>
            <odom_topic>/model/car/odometry</odom_topic>
            <tf_topic>/model/car/tf</tf_topic>
            <frame_id>odom</frame_id>
            <child_frame_id>chassis::chassis_link</child_frame_id>
            <odom_publish_frequency>30</odom_publish_frequency>
        </plugin>
        <!--충돌 방지를 위해서 contact sensor를 추가하였음.-->
        <plugin filename="libignition-gazebo-contact-system.so"
                name="ignition::gazebo::systems::Contact">
        </plugin>
        <!--자동차를 키보드로 움직여보기 위한 코드. 튜토리얼 중 추가하였음.-->
        <plugin filename="ignition-gazebo-triggered-publisher-system"
            name="ignition::gazebo::v6::systems::TriggeredPublisher">
            <input type="ignition.msgs.Int32" topic="/keyboard/keypress">
                <match field="data">16777235</match>
            </input>
            <output type="ignition.msgs.Twist" topic="/cmd_vel">
                linear: {x: 0.5}, angular: {z: 0.0}
            </output>
        </plugin>

        <plugin filename="ignition-gazebo-triggered-publisher-system"
            name="ignition::gazebo::v6::systems::TriggeredPublisher">
            <input type="ignition.msgs.Int32" topic="/keyboard/keypress">
                <match field="data">16777237</match>
            </input>
            <output type="ignition.msgs.Twist" topic="/cmd_vel">
                linear: {x: -0.5}, angular: {z: 0.0}
            </output>
        </plugin>

        <plugin filename="ignition-gazebo-triggered-publisher-system"
            name="ignition::gazebo::v6::systems::TriggeredPublisher">
            <input type="ignition.msgs.Int32" topic="/keyboard/keypress">
                <match field="data">16777234</match>
            </input>
            <output type="ignition.msgs.Twist" topic="/cmd_vel">
                linear: {x: 0.2}, angular: {z: 0.5}
            </output>
        </plugin>

        <plugin filename="ignition-gazebo-triggered-publisher-system"
            name="ignition::gazebo::v6::systems::TriggeredPublisher">
            <input type="ignition.msgs.Int32" topic="/keyboard/keypress">
                <match field="data">16777236</match>
            </input>
            <output type="ignition.msgs.Twist" topic="/cmd_vel">
                linear: {x: 0.2}, angular: {z: -0.5}
            </output>
        </plugin>
    </model>
</sdf>